<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FLASH ANZAN â€” ãƒ•ãƒ©ãƒƒã‚·ãƒ¥æš—ç®—ï¼ˆå˜ä¸€HTMLï¼‰</title>
  <style>
    :root{
      --bg:#0b0b10; --fg:#f2f4f8; --muted:#b6c2cf; --accent1:#00e5ff; --accent2:#ff4d6d; --accent3:#ffd166; --panel:#10131a;
    }
    html,body{height:100%; margin:0; background:radial-gradient(120% 150% at 10% -10%, #122 0%, #0b0b10 55%, #050507 100%); color:var(--fg); font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP",sans-serif;}
    .wrap{min-height:100%; display:grid; grid-template-rows:auto 1fr auto}
    header,footer{padding:10px 14px; opacity:.9}
    header{display:flex; gap:10px; align-items:center; font-weight:700; letter-spacing:.06em}
    .badge{font-size:12px; padding:4px 8px; border:1px solid #fff2; border-radius:999px}
    .stage{position:relative; display:grid; place-items:center; padding:20px}
    .panel{width:min(920px,94vw); border-radius:16px; background:linear-gradient(180deg,#ffffff0c,#00000040); box-shadow:0 10px 30px #0007; padding:18px}
    .title{font-size:clamp(22px,4.5vw,40px); font-weight:900; margin:8px 6px}
    .subtitle{margin:0 6px 12px; opacity:.82}

    .grid{display:grid; grid-template-columns: 1.2fr 1fr; gap:16px}
    @media (max-width:860px){.grid{grid-template-columns:1fr}}

    .board{display:grid; place-items:center; border-radius:14px; background:radial-gradient(100% 120% at 50% 20%, #ffffff12, #00000033); min-height:360px; position:relative; overflow:hidden}
    .number{font-weight:1000; letter-spacing:.04em; text-shadow: 0 10px 40px #000; user-select:none}
    .number.main{font-size: clamp(54px, 14vw, 160px);}
    .number.ghost{position:absolute; opacity:.08; filter: blur(6px); font-size: clamp(80px, 24vw, 240px);}

    .controls{border-radius:14px; background:linear-gradient(180deg,#ffffff10,#00000030); padding:14px; display:grid; gap:10px}
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    label{font-size:12px; opacity:.8}
    input[type=number],select{all:unset; background:#ffffff18; padding:8px 10px; border-radius:10px; font-weight:700; min-width:64px}
    button{all:unset; cursor:pointer; padding:10px 14px; border-radius:12px; border:1px solid #ffffff22; background:linear-gradient(120deg,var(--accent1),#2dd4bf); color:#041218; font-weight:900; letter-spacing:.05em; box-shadow:0 8px 20px #0008}
    button.secondary{background:linear-gradient(180deg,#ffffff20,#00000020); color:var(--fg)}
    button.danger{background:linear-gradient(120deg,#ff4d6d,#ffb703); color:#1a0b00}
    button:disabled{opacity:.5; cursor:not-allowed}

    .meter{height:8px; background:#ffffff18; border-radius:999px; overflow:hidden}
    .meter>div{height:100%; width:0%; background:linear-gradient(90deg,var(--accent2),var(--accent3)); transition:width .2s}

    .statgrid{display:grid; grid-template-columns:repeat(4,minmax(120px,1fr)); gap:10px}
    @media (max-width:860px){.statgrid{grid-template-columns:repeat(2,minmax(120px,1fr))}}
    .stat{background:#00000026; border:1px solid #ffffff14; border-radius:12px; padding:10px}
    .label{font-size:12px; opacity:.7}
    .value{font-size:22px; font-weight:900}

    .answerBox{display:flex; gap:10px; justify-content:center; align-items:center}
    .answerBox input{all:unset; background:#ffffff18; padding:14px 16px; border-radius:12px; font-size:26px; font-weight:900; width:200px; text-align:center}

    .log{max-height:180px; overflow:auto; font-family:ui-monospace,SFMono-Regular,Menlo,monospace; font-size:12px; opacity:.85; background:#00000026; border:1px solid #ffffff14; border-radius:12px; padding:10px}
    .ok{color:#7ee787}
    .ng{color:#ff7b72}

    .warn{font-size:12px; opacity:.7}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="badge">ğŸ§  FLASH ANZAN</div>
      <div class="badge">æ•°å­—ãŒé«˜é€Ÿè¡¨ç¤º â†’ åˆè¨ˆã‚’å…¥åŠ›</div>
      <div class="badge" id="bestBadge">BEST STREAK: 0</div>
    </header>

    <main class="stage">
      <div class="panel">
        <h1 class="title">è¦‹ãˆãŸç¬é–“ã€åˆè¨ˆã‚’çµ„ã¿ç«‹ã¦ã‚ã€‚</h1>
        <p class="subtitle">è¨­å®šã—ãŸæ¡æ•°ãƒ»å€‹æ•°ãƒ»ã‚¹ãƒ”ãƒ¼ãƒ‰ã§æ•°å­—ãŒã€Œãƒ‘ãƒƒã€ã¨è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚ã™ã¹ã¦çµ‚ã‚ã£ãŸã‚‰åˆè¨ˆã‚’å…¥åŠ›ï¼</p>

        <div class="grid">
          <!-- LEFT: BOARD -->
          <section class="board" id="board">
            <div class="number ghost" id="ghost">888</div>
            <div class="number main" id="main">READY</div>
          </section>

          <!-- RIGHT: CONTROLS -->
          <aside class="controls">
            <div class="row">
              <label>æ¡æ•°</label>
              <select id="digits">
                <option value="1">1 æ¡</option>
                <option value="2" selected>2 æ¡</option>
                <option value="3">3 æ¡</option>
              </select>
              <label>å€‹æ•°</label>
              <input id="count" type="number" value="10" min="3" max="50" />
            </div>
            <div class="row">
              <label>è¡¨ç¤ºé€Ÿåº¦</label>
              <select id="speed">
                <option value="700">ã‚†ã£ãã‚Š</option>
                <option value="500" selected>æ™®é€š</option>
                <option value="350">é€Ÿã„</option>
                <option value="240">è¶…é€Ÿ</option>
              </select>
              <label>ä¼‘æ­¢</label>
              <select id="gap">
                <option value="0">ãªã—</option>
                <option value="100">çŸ­ã„</option>
                <option value="200" selected>æ¨™æº–</option>
                <option value="400">é•·ã„</option>
              </select>
            </div>
            <div class="row">
              <label>å€¤ã®ç¯„å›²</label>
              <select id="range">
                <option value="pos" selected>æ­£ã®æ•°ã®ã¿</option>
                <option value="mix">æ­£è² ãƒŸãƒƒã‚¯ã‚¹</option>
              </select>
              <label>å‡ºé¡Œ</label>
              <select id="mode">
                <option value="sum" selected>åˆè¨ˆï¼ˆè¶³ã—ç®—ï¼‰</option>
                <option value="diff">åˆè¨ˆï¼ˆÂ±ãƒŸãƒƒã‚¯ã‚¹ï¼‰</option>
              </select>
            </div>
            <div class="row">
              <button id="start">é–‹å§‹ (Space)</button>
              <button class="secondary" id="stop">åœæ­¢/ãƒªã‚»ãƒƒãƒˆ</button>
            </div>

            <div class="meter" aria-hidden>
              <div id="progress"></div>
            </div>

            <div class="statgrid">
              <div class="stat"><div class="label">ç¾åœ¨ã®é€£å‹</div><div class="value" id="streak">0</div></div>
              <div class="stat"><div class="label">æœ€é•·é€£å‹</div><div class="value" id="best">0</div></div>
              <div class="stat"><div class="label">æœ€å¾Œã®çµæœ</div><div class="value" id="last">--</div></div>
              <div class="stat"><div class="label">åˆè¨ˆï¼ˆæ­£è§£ï¼‰</div><div class="value" id="answerShow">--</div></div>
            </div>

            <div class="answerBox" id="answerBox" style="display:none">
              <input id="answer" type="number" inputmode="numeric" placeholder="åˆè¨ˆã‚’å…¥åŠ›" />
              <button class="danger" id="submit">åˆ¤å®š</button>
            </div>

            <details>
              <summary>å±¥æ­´</summary>
              <div class="log" id="log"></div>
            </details>

            <p class="warn">â€» å¼·ã„ç‚¹æ»…ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚èƒŒæ™¯ã®æ˜æ»…ã‚’æœ€å°ã«ã—ã€è¦–èªæ€§ã‚’å„ªå…ˆã—ã¦ã„ã¾ã™ã€‚</p>
          </aside>
        </div>
      </div>
    </main>

    <footer>
      <small>Â© 2025 Flash Anzan â€” ã‚·ãƒ³ã‚°ãƒ«HTMLç‰ˆ / ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰: Space=é–‹å§‹ã€Enter=åˆ¤å®š</small>
    </footer>
  </div>

<script>
(() => {
  // Elements
  const main = document.getElementById('main');
  const ghost = document.getElementById('ghost');
  const progress = document.getElementById('progress');
  const startBtn = document.getElementById('start');
  const stopBtn = document.getElementById('stop');
  const digitsSel = document.getElementById('digits');
  const countInput = document.getElementById('count');
  const speedSel = document.getElementById('speed');
  const gapSel = document.getElementById('gap');
  const rangeSel = document.getElementById('range');
  const modeSel = document.getElementById('mode');
  const answerBox = document.getElementById('answerBox');
  const answerInput = document.getElementById('answer');
  const submitBtn = document.getElementById('submit');
  const logEl = document.getElementById('log');
  const streakEl = document.getElementById('streak');
  const bestEl = document.getElementById('best');
  const lastEl = document.getElementById('last');
  const ansShowEl = document.getElementById('answerShow');
  const bestBadge = document.getElementById('bestBadge');

  // WebAudio beeps (no external files)
  const audio = new (window.AudioContext || window.webkitAudioContext)();
  function beep(freq=660, t=0.05, vol=0.12){
    const o = audio.createOscillator(); const g = audio.createGain();
    o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
    o.connect(g).connect(audio.destination); o.start(); o.stop(audio.currentTime + t);
  }
  function okTone(){ beep(880, .08, .16); }
  function ngTone(){ beep(180, .3, .15); }

  // State
  let running=false, seq=[], idx=0, timer=null, total=0, streak=0, best=+(localStorage.getItem('flash_anzan_best')||0);
  bestEl.textContent = best; bestBadge.textContent = `BEST STREAK: ${best}`;

  function randInt(d){
    const min = Math.pow(10, d-1), max = Math.pow(10,d)-1; // inclusive range
    return Math.floor(Math.random()*(max-min+1))+min;
  }
  function randSigned(d){
    const v = randInt(d); return Math.random()<0.5? v : -v;
  }
  function makeSeq(){
    const d = +digitsSel.value; const n = Math.max(3, Math.min(50, +countInput.value||10));
    const mix = (rangeSel.value==='mix' || modeSel.value==='diff');
    seq = Array.from({length:n}, _=> mix ? randSigned(d) : randInt(d));
    if(modeSel.value==='sum'){ total = seq.reduce((a,b)=>a+b,0); }
    else { total = seq.reduce((a,b)=>a+b,0); } // same, but future extension supported
    idx=0;
  }

  function formatNum(x){ return x.toLocaleString('ja-JP'); }

  function showNumber(v){
    main.textContent = (v>=0? v : '\u2212'+String(Math.abs(v)));
    ghost.textContent = main.textContent; // visual echo
  }

  function setProgress(p){ progress.style.width = Math.max(0,Math.min(1,p))*100 + '%'; }

  function resetBoard(){
    running=false; clearInterval(timer); timer=null; idx=0; seq=[]; setProgress(0); ansShowEl.textContent='--';
    main.textContent='READY'; ghost.textContent='888'; answerBox.style.display='none';
  }

  function start(){
    if(running) return; audio.resume?.();
    makeSeq(); running=true; setProgress(0); answerBox.style.display='none'; ansShowEl.textContent='--'; lastEl.textContent='--';

    // Countdown 3-2-1
    let pre=3; main.textContent='3'; ghost.textContent='3'; beep(520,.10,.14);
    const preT = setInterval(()=>{
      pre--; if(pre>0){ main.textContent=String(pre); ghost.textContent=String(pre); beep(520+. *0, .08, .12); }
      else{ clearInterval(preT); runSequence(); }
    }, 400);
  }

  function runSequence(){
    const N = seq.length; const t = +speedSel.value; const gap = +gapSel.value;
    const totalStep = N; let shown=0; setProgress(0);
    const show = () => {
      if(!running) return;
      if(shown>=N){
        clearInterval(timer); timer=null; askAnswer(); return;
      }
      const v = seq[shown++]; showNumber(v); okTone();
      setProgress(shown/totalStep);
    };
    show();
    timer = setInterval(show, t + gap);
  }

  function askAnswer(){
    main.textContent = 'ï¼ ?'; ghost.textContent='?'; answerBox.style.display='flex'; answerInput.value=''; answerInput.focus(); ansShowEl.textContent=total; // reveal afteråˆ¤å®šã§ã‚‚OKâ†’ã“ã“ã¯ç·´ç¿’ç”¨é€”ã§ä¸€æ™‚è¡¨ç¤º
  }

  function submit(){
    if(!answerBox.style.display || answerBox.style.display==='none') return;
    const val = +answerInput.value; const ok = (val===total);
    lastEl.textContent = ok ? 'æ­£è§£' : 'ä¸æ­£è§£';
    if(ok){ streak++; best = Math.max(best, streak); localStorage.setItem('flash_anzan_best', String(best)); bestEl.textContent=best; bestBadge.textContent=`BEST STREAK: ${best}`; okTone(); }
    else { streak=0; ngTone(); }
    streakEl.textContent = String(streak);

    const row = document.createElement('div');
    row.innerHTML = `${new Date().toLocaleTimeString()} | <span class="${ok?'ok':'ng'}">${ok?'OK':'NG'}</span> | seq: [${seq.join(', ')}] | ans=${formatNum(total)} | you=${formatNum(val||0)}`;
    logEl.prepend(row);

    // ready next
    setTimeout(()=>{ resetBoard(); }, 500);
  }

  function stop(){ resetBoard(); }

  // Events
  startBtn.addEventListener('click', start);
  stopBtn.addEventListener('click', stop);
  submitBtn.addEventListener('click', submit);
  answerInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter') submit(); });
  document.addEventListener('keydown', (e)=>{ if(e.code==='Space'){ e.preventDefault(); if(!running) start(); } });

  // Init
  resetBoard();
})();
</script>
</body>
</html>
